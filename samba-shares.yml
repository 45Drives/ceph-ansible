---
- hosts:
  - smbs

  gather_facts: false
  any_errors_fatal: true
  become: true

  tags:
    - always

  vars:
    delegate_facts_host: True

  tasks:
    - import_role:
        name: ceph-smb
        tasks_from: configure_vfs_shares.yml
      when:
        - configure_shares | bool
        - samba_cephfs_module | bool

    - import_role:
        name: ceph-smb
        tasks_from: configure_kernel_shares.yml
      when:
        - configure_shares | bool
        - not samba_cephfs_module | bool

