---
- hosts:
  - smbs

  gather_facts: false
  any_errors_fatal: true
  become: true

  tags:
    - always

  vars:
    delegate_facts_host: True

  tasks:
    - import_role:
        name: ceph-facts
      when:
        - configure_shares | bool
    - import_role:
        name: ceph-smb
        tasks_from: loop_shares.yml
      when:
        - configure_shares | bool