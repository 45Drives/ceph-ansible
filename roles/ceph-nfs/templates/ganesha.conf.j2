#jinja2: trim_blocks: "true", lstrip_blocks: "true"
# {{ ansible_managed }}

{% if ceph_nfs_dynamic_exports | bool and not ceph_nfs_rados_backend | bool %}
%include /etc/ganesha/export.d/INDEX.conf
{% endif %}

NFS_Core_Param
{
{% if ceph_nfs_bind_addr is defined %}
       Bind_Addr={{ ceph_nfs_bind_addr }};
{% endif %}
{{ ganesha_core_param_overrides | default(None) }}
}

{% if ceph_nfs_disable_caching | bool or nfs_file_gw | bool %}
EXPORT_DEFAULTS {
	Attr_Expiration_Time = 0;
}

CACHEINODE {
	Dir_Chunk = 0;

	NParts = 1;
	Cache_Size = 1;
}
{% endif %}

{% if ceph_nfs_rados_backend | bool %}
RADOS_URLS {
   ceph_conf = '/etc/ceph/{{ cluster }}.conf';
   userid = "{{ ceph_nfs_ceph_user }}";
}
%url rados://{{ ceph_nfs_ganesha_pool }}/{{ ceph_nfs_rados_export_index }}

NFSv4 {
	RecoveryBackend = 'rados_kv';
	IdmapConf = "{{ ceph_nfs_idmap_conf }}";
}
RADOS_KV {
	ceph_conf = '/etc/ceph/{{ cluster }}.conf';
	userid = "{{ ceph_nfs_ceph_user }}";
	pool = "{{ ceph_nfs_ganesha_pool }}";
}
{% endif %}

LOG {
        Facility {
                name = FILE;
                destination = "{{ ceph_nfs_log_file }}";
                enable = active;
        }

        {{ ganesha_log_overrides | default(None) }}
}

{{ ganesha_conf_overrides | default(None) }}
